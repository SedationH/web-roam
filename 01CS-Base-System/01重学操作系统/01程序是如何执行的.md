## 问题

### **相比32位，64位的优势是什么？**



解答需要具体的方面

1. 软件
2. 操作系统
3. CPU



## 图灵机(Turing machine)

### 图灵机提供了计算机的**抽象**

> 图灵通过数学证明了，一个问题如果可以拆解成图灵机的可执行步骤，那问题就是可计算的。另一方面，图灵机定义了计算机的组成以及工作原理，但是没有给出具体的实现。

1. 清楚的定义了计算机的边界，可计算理论

   > - 图灵发现如果一个问题是可计算的，那么它的解决方案就必须可以被具化成一条条的指令，也就是可以使用图灵机处理。因此，不能使用图灵机处理的问题，都是不可计算的问题。

2. 定义了计算机由哪些部分组成，程序又是如何执行的。



### 图灵机的**内部构造**

1. 图灵机拥有一条无限长的纸带，纸带上是一个格子挨着一个格子，格子中可以写字符（格子相当于内存，字符相当于内存中的数据｜程序）
2. 图灵机有个读写头，读写头可以读取｜改写格子上的字符
3. 读写头上面还有这图灵机的存储、控制和运算单元



### 图灵机如何执行程序

e.g. 11 + 15



```js
const TAPE = [], state = []
for(let i=0;i<TAPE.length;i++) {
  if(TAPE[i] not in instructions){
    state.push()
  }else{
    operate state via TAPE[i]
  }
}
```

![image-20200914101023177](http://picbed.sedationh.cn/image-20200914101023177.png)

### 冯诺伊曼模型

计算机的具体实现在1945年，由冯诺伊曼和其他几位科学家在著名的101报告中提出，报告遵循了图灵机的设计，并提出用电子元件构造计算机，约定了用二进制进行计算和存储，并且将计算机结构分成一下五个部分

1. 输入设备
2. 输出设备
3. 内存
4. 中央处理器
5. 总线



### 内存

程序和数据都被存储在一个被称作内存的线性排列存储区域

我们通常说的内存都是随机存取器，读取和写入任何一个地址的速度都是一样的

### CPU

冯诺伊曼模型中的CPU负责控制和计算。为了方便计算较大的数值，CPU每次可计算多个字节的数据。

- 如果CPU每次可以计算4B，那么我们称作32位CPU
- 如果CPU每次可以计算8B，那么我们称作64位CPU



**寄存器**在CPU中，暂时存储参与运算的数字和指令

- 特殊寄存器：存储指令的内存地址
- 指令寄存器：存储下一条要执行的指令
- 通用寄存器：用户可编程



1位的CPU可以操作多大空间？

A：无限大，如地址空间40位，可以分为40步传递电平信息，但这样太慢了，我们一般让cpu并行发送信息



### 总线

用于不同设备或者元器件之间的通讯

- 地址总线：指定CPU将要操作的内存地址
- 数据总线：读写内存中的数据

**当CPU需要读写内存的时候，先要通过地址总线来指定内存地址，再通过数据总线来传输数据**

- 控制总线：发送和接受关键信号

## 在冯诺伊曼体系上程序如何执行

1. CPU读取PC指针指向的指令，倒入指令寄存器
2. CPU分析指令，根据 需要计算 ? 逻辑运算单元 : 控制单元
3. PC指针自增(32位OS中，指令以4B为单元进行存储，指针自增4)



Tip

1. 内存是个随机存取器，但是我们通常不会把指令和数据存在一起（安全）
2. PC指针（程序指针）也是个寄存器，64OS 提供 64bit的寄存器，寻址范围更大，但仍收到OS地址总线的限制（地址总线的位宽不一定是64）
3. PC指针读取、执行、再读取 -> loop() 这个循环的过程称为CPU的指令周期



## a = 11 + 15

CPU执行的是上述代码编译后的结果 -> CPU所能够执行的指令

可执行程序进入内存

分别位数据和操作分配相应的空间和指令

![image-20200929100045002](http://picbed.sedationh.cn/image-20200929100045002.png)

2. 编译器将a=11+15转换成了 4 条指令，程序启动后，这些指令被导入了一个专门用来存储指令的区域，也就是正文段。如上图所示，这 4 条指令被存储到了 0x200-0x20c 的区域中：

0x200 位置的 load 指令将地址 0x100 中的数据 11 导入寄存器 R0；

0x204 位置的 load 指令将地址 0x104 中的数据 15 导入寄存器 R1；

0x208 位置的 add 指令将寄存器 R0 和 R1 中的值相加，存入寄存器 R2；

0x20c 位置的 store 指令将寄存器 R2 中的值存回数据区域中的 0x1108 位置。

3. 具体执行的时候，PC 指针先指向 0x200 位置，然后依次执行这 4 条指令。

Tip:

1. 变量a实际上是内存中的一个地址，a是助记符
2. 正文段的地址拿到的数据就是指令 这是有意义的（见下文
3. 每次操作四个地址（32位），这是在使用32位的cpu，32位的cup中，指令（正文段数据） 也是32位，但数据段的数据是可以小于32位的



## 指令分析

0x8c000100作为例子🌰 -> 1000 11,00 00,00 0000 0000 0001 0000 0000

- 最左边的 6 位，叫作操作码，英文是 OpCode，100011 代表 load 指令；

- 中间的 4 位 0000是寄存器的编号，这里代表寄存器 R0；

- 后面的 22 位代表要读取的地址，也就是 0x100。

所以我们是把操作码、寄存器的编号、要读取的地址合并到了一个 32 位的指令中。



- 构建指令的过程，叫做指令的编码，通常由编译器完成
- 解析指令的过程，叫做指令的解码，由CPU完成

上文提过指令周期，就是在说

- 首先 CPU 通过 PC 指针读取对应内存地址的指令，我们将这个步骤叫作 Fetch，就是获取的意思。

- CPU 对指令进行解码，我们将这个部分叫作 Decode。

- CPU 执行指令，我们将这个部分叫作 Execution。

- CPU 将结果存回寄存器或者将寄存器存入内存，我们将这个步骤叫作 Store。
- 程序指针下移



**指令的执行速度**

之前我们提到过 CPU 是用石英晶体产生的脉冲转化为时钟信号驱动的，每一次时钟信号高低电平的转换就是一个周期，我们称为时钟周期。CPU 的主频，说的就是时钟信号的频率。比如一个 1GHz 的 CPU，说的是时钟信号的频率是 1G。

是不是每个时钟周期都可以执行一条指令？其实，不是的，多数指令不能在一个时钟周期完成，通常需要 2 个、4 个、6 个时钟周期。

留个坑 [时钟周期,机器周期,指令周期](https://blog.csdn.net/lishuhuakai/article/details/8945750)



### QA

1. 线路位宽问题

数据在单个线路中只能串行发送数据，如果希望每次多传送一些数据，就需要增加线路，也就是需要并行，

操作内存其实就是根据地址存取数据的过程，不同的位宽(线路数量)影响操作地址的范围

> e.g.
>
> - 1条地址 [0,1]
> - 2 [0,3]
> - ...
> - 32 [0,2^32-1]10 -> [0x00000000,0xffffffff]

> 1GB = 2^10(1024)MB = 2^20KB = 2^30B
>
> 4GB = 2^32 B
>
> 计算机内存的地址编码是以**字节(B)**作为单位的

也就是说，想要**操作4G内存，就需要至少32条地址总线**



2. 64位和32位的计算

CPU也有位宽(计算数字的bit个数)，其内部的运算和寄存器的大小，都和位宽有联系

32位宽的CPU因为寄存器和读入的限制，64位的数字需要两次读入，并且利用算法进行运算

从这点来看，当数据规模不大的时候，64CPU不一定处理速度就surpass32CPU



3. Difference between 32-bit and 64-bit operating systems &  32-bit 64-bit processor

[参考](https://www.geeksforgeeks.org/difference-32-bit-64-bit-operating-systems/)

与OS紧密相连的有个virtual memory，os通过地址操作内存

地址的Max address  -> os位数

- 2^32-1 -> 32-bit os
- more than 2^32 less than2^64 -> 32-bit os



## Ans

1. 如果说的是 64 位宽 CPU，那么有 2 个优势：

   - 优势 1：64 位 CPU 可以执行更大数字的运算，这个优势在普通应用上不明显，但是对于数值计算较多的应用就非常明显。

   - 优势 2：64 位 CPU 可以寻址更大的内存空间

2. 如果 32 位/64 位说的是程序，那么说的是指令是 64 位还是 32 位的。32 位指令在 64 位机器上执行，困难不大，可以兼容。 如果是 64 位指令，在 32 位机器上执行就困难了。因为 32 位指令在 64 位机器执行的时候，需要的是一套兼容机制；但是 64 位指令在 32 位机器上执行，32 位的寄存器都存不下指令的参数。

3. 操作系统也是一种程序，如果是 64 位操作系统，也就是操作系统中程序的指令都是 64 位指令，因此不能安装在 32 位机器上。